name: Deploy MkDocs to GitHub Pages

on:
  push:
    branches:
      - main
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: pages
  cancel-in-progress: false

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'
      
      - name: Install MkDocs
        run: |
          pip install mkdocs mkdocs-material pymdown-extensions
      
      - name: Build site
        run: |
          mkdir -p build/docs
          
          for dir in 00_* 01_* 02_* 03_* 04_* 05_* 06_* 07_* 08_* 09_* 10_* 11_* 12_* 13_* 14_* 15_* 16_* 17_* 18_* 19_* 20_* Exercises Projects Resources; do
            if [ -d "$dir" ]; then
              cp -r "$dir" build/docs/
            fi
          done
          
          cp *.md build/docs/ 2>/dev/null || true
          
          cat > build/mkdocs.yml << 'EOF'
          site_name: VibeLearning
          site_description: A comprehensive Python learning resource
          site_url: https://jackc0re.github.io/VibeLearning/
          docs_dir: docs
          site_dir: site
          theme:
            name: material
            palette:
              # Light mode
              - scheme: default
                primary: indigo
                accent: indigo
                toggle:
                  icon: material/brightness-7
                  name: Switch to dark mode
              # Dark mode  
              - scheme: slate
                primary: indigo
                accent: indigo
                toggle:
                  icon: material/brightness-4
                  name: Switch to light mode
            features:
              # Top navigation tabs for main sections
              - navigation.tabs
              - navigation.tabs.sticky
              # Collapse sidebar sections by default  
              - navigation.sections
              # Auto-collapse other sections when one opens
              - navigation.collapse
              - search.suggest
              - search.highlight
              - content.code.copy
              - content.code.annotate
              - content.action.edit
          plugins:
            - search
          markdown_extensions:
            - pymdownx.highlight:
                anchor_linenums: true
            - pymdownx.superfences
            - pymdownx.inlinehilite
            - tables
            - toc:
                permalink: true
            - admonition
            - pymdownx.details
          nav:
            - Home: README.md
            - Getting Started:
              - Overview: 00_getting_started/README.md
              - Python Setup: 00_getting_started/01_python_setup.md
              - Running Code: 00_getting_started/02_running_code.md
              - Using This Repo: 00_getting_started/03_using_this_repo.md
            - Foundations:
              - Overview: 01_foundations/README.md
              - Variables & Types: 01_foundations/01_variables_and_types/README.md
              - Operators: 01_foundations/02_operators/README.md
              - Control Flow: 01_foundations/03_control_flow/README.md
              - Loops: 01_foundations/04_loops/README.md
              - Functions: 01_foundations/05_functions_basics/README.md
              - Input/Output: 01_foundations/06_input_output/README.md
            - Data Structures:
              - Overview: 02_data_structures/README.md
              - Lists & Arrays: 02_data_structures/01_lists_arrays/README.md
              - Strings: 02_data_structures/02_strings/README.md
              - Dictionaries: 02_data_structures/03_dictionaries_maps/README.md
              - Sets: 02_data_structures/04_sets/README.md
              - Tuples: 02_data_structures/05_tuples/README.md
              - Stacks & Queues: 02_data_structures/06_stacks_queues/README.md
              - Linked Lists: 02_data_structures/07_linked_lists/README.md
              - Trees: 02_data_structures/08_trees/README.md
              - Graphs: 02_data_structures/09_graphs/README.md
              - Hash Tables: 02_data_structures/10_hash_tables/README.md
            - Algorithms: 03_algorithms/README.md
            - OOP Concepts: 04_oop_concepts/README.md
            - Functional Programming: 05_functional_programming/README.md
            - Software Design: 06_software_design/README.md
            - Design Patterns: 07_design_patterns/README.md
            - Error Handling: 08_error_handling/README.md
            - Testing: 09_testing/README.md
            - File I/O: 10_file_io/README.md
            - Performance: 11_memory_performance/README.md
            - Concurrency: 12_concurrency/README.md
            - Modules & Packages: 13_modules_packages/README.md
            - Debugging: 14_debugging/README.md
            - Version Control: 15_version_control/README.md
            - Libraries: 16_essential_libraries/README.md
            - CS Fundamentals: 17_cs_fundamentals/README.md
            - APIs: 18_working_with_apis/README.md
            - Data Processing: 19_data_processing/README.md
            - Web Basics: 20_web_basics/README.md
            - Resources: Resources/glossary.md
          EOF
          
          cd build
          mkdocs build
          mv site ../_site
      
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: ./_site

  deploy:
    needs: build
    runs-on: ubuntu-latest
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
